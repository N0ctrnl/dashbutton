# dashbtn
needs arm-none-eabi- toolchain, lua, sox

You can download a suitable toolchain at 

https://launchpad.net/gcc-arm-embedded

The payload for the exploit is a tiny chunk of assembler code. 

I assembled it with the gnu assembler arm-none-eabi-as flashdump.s and
dumped it with objdump: arm-none-eabi-objdump -S a.out
Then I copied the opcodes by hand into the lua script flashdump.lua.
This script generates a hex-string from the payload which can be fed
to fsk via stdin. fsk prepends the correct crc and length and outputs
a raw signed int 16 little endian 48kHz audio file. This file can be
played or converted with sox.

play.sh basically does all the necessary things.
just invoke it with the payload asm file as argument.
example: ./play.sh flashdump.s

The led of the button stops fading once the payload is executed and
turns off once the flash dump is complete when the button shut down
due to the expiring watchdog.

The lua script also does another trick: it packs some 32bit words into
the payload so that these words will be on the stack and can be pop'ed
once the code runs. This is done for the uart tx function and some
register locations - e.g. for the watchdog. This trick reduces the
payload size a bit.



There are several payload examples for the exploit available 
as asm sources:


flashdump.s:

This is a tiny chunk of code which dumps the flash and then lets 
the watchdog expire so the button shuts down afterwards. 

This code uses an existing UART send routine from the original 
firmware.


flashdump_directuart.s:

Same functionality as flashdump.s, but directly controls the UART


code_upload.s:

Small program to upload further program code over the UART.

This program reads exactly 4K of data from the UART and writes the data
into the RAM at address 0x20024000. It then directly jumps to the 
base address of the uploaded code.

The uploaded code should either be linked to upload base address 
0x20024000 or it must be fully relocatable.

A simple sample code and a helper script to compile and upload the
program code from the host is added as well.

Call 

./play.sh code_upload.s 

to upload the exploit code to the dashbutton. As soon as the LED stops
dimming, run

./upload.sh testcode_flashdump_directuart

The sample code then will dump the flash content again.






